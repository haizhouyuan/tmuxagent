pipelines:
- match:
    any_of:
    - window_name: ^agent:codex-ci$
  name: demo-pipeline
  stages:
  - actions_on_start:
    - send_keys: npm run lint
    fail_when:
      any_of:
      - log_regex: (?i)error
    name: lint
    on_fail:
    - retry:
        max: 1
    on_fail_notify:
      body: 'é˜¶æ®µ **lint** æ‰§è¡Œå¤±è´¥


        ç®¡é“: demo-pipeline

        é”™è¯¯: {error_message}

        æ—¶é—´: {timestamp}'
      title: âŒ lint å¤±è´¥
    on_success_notify:
      body: 'é˜¶æ®µ **lint** å·²æˆåŠŸå®Œæˆ


        ç®¡é“: demo-pipeline

        æ—¶é—´: {timestamp}'
      title: âœ… lint å®Œæˆ
    success_when:
      any_of:
      - log_regex: (?i)0 problems
      - message_type: STATUS
    triggers:
      any_of:
      - log_regex: (?i)start lint
  - actions_on_start:
    - send_keys: npm run build
    fail_when:
      any_of:
      - log_regex: (?i)failed
    name: build
    on_fail:
    - ask_human: Build failed, decide next step
    on_fail_notify:
      body: 'é˜¶æ®µ **build** æ‰§è¡Œå¤±è´¥


        ç®¡é“: demo-pipeline

        é”™è¯¯: {error_message}

        æ—¶é—´: {timestamp}'
      title: âŒ build å¤±è´¥
    on_start_notify:
      body: 'é˜¶æ®µ **build** æ­£åœ¨ç­‰å¾…äººå·¥å®¡æ‰¹


        ç®¡é“: demo-pipeline

        æ—¶é—´: {timestamp}'
      title: ğŸ”” demo-pipeline - build éœ€è¦å®¡æ‰¹
    on_success_notify:
      body: 'é˜¶æ®µ **build** å·²æˆåŠŸå®Œæˆ


        ç®¡é“: demo-pipeline

        æ—¶é—´: {timestamp}'
      title: âœ… build å®Œæˆ
    require_approval: true
    success_when:
      any_of:
      - log_regex: (?i)Build complete
    triggers:
      any_of:
      - after_stage_success: lint
principles:
- Automate routine steps; pause for critical approvals.
